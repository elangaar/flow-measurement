{% extends "base.html" %}
{% block head %}
<style>
h2 {
    margin-bottom: 20px;
}
.hidden {
    visibility: hidden;
}
.visible {
    visibility: visible;
}
#test-div {
    border: 2px solid red;
}
</style>
{% endblock head %}
{% block content %}
<p> Wybierz stację: 
<select id='station' form='values-form'>
    <option value='0'> ----- </option>
{% for station in stations %}
    <option value='{{ station.id }}'> {{ station.name }} </option>
{% endfor %}
</select>
</p>
<p> Wybierz urządzenie:
<select id='device' form='values-form'>
    <option value='0'> ----- </option>
{% for device in devices %}
<option value='{{ device.id }}'> {{ device.name }}, {{ device.serial_number }}
</option>
{% endfor %}
</select>
</p>
<form method='POST' id='values-form'> {% csrf_token %}
    <input name='temperature' type='text' id='temperature' placeholder='temperatura [&#176;C]' /><br />
    <input type='text' id='pressure' placeholder='ciśnienie [hPa]' /><br />
    <input type='text' id='gas-meter-volume' placeholder='objętość z gazomierza [m&#179;]' /><br />
    <input type='text' id='controller-volume' placeholder='objętość ze sterownika [m&#179;]' /><br />
    <input type='submit' id='submit-button' value='Wprowadź wartości' />
</form>
<div id='parameters'>
    <p class='hidden'> Temperatura: <span id='temp1'></span> K </p>
    <p class='hidden'> Ciśnienie: <span id='press1'> </span> hPa</p>
    <p class='hidden'> Objętość na gazomierzu: <span id='gas1'> </span> m&#179; </p>
    <p class='hidden'> Objętość na sterowniku: <span id='contr1'> </span> m&#179;  </p>
</div>
<div id='results'> 
    <p>Stacja: <span id='station-selected'> </span></p>
    <p>Urządzenie: <span id='device-selected'> </span></p>
    <p>Współczynnik przeliczania: <span id='coefficient'> </span></p>
    <p>Spodziewana wartość: <span id='expectedVolume'></span></p>
    <p>Błąd wskazania: <span id='error'></span></p>
</div>

<div id='settings'>
    <a href='{% url "stations" %}'>Stacje</a>
    <a href='{% url "devices" %}'>Urządzenia</a>
</div>

<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'> </script>

<script>
$('#values-form').on('submit', function(e) {
    e.preventDefault();
    addParameters();
});
function addParameters() {
    $.ajax({
        type: 'POST',
        url: '/parameters/',
        data: {
            device: $('#device option:selected').val(),
            station: $('#station option:selected').val(),
            temperature: $('#temperature').val(),
            pressure: $('#pressure').val(),
            gasMeterVolume: $('#gas-meter-volume').val(),
            controllerVolume: $('#controller-volume').val(),
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) {
            displayValues(data);
        }

    });
}

function displayValues(data) {
    $('#parameters .hidden').removeClass('hidden');
    $('#temp1').text(data['temperature']);
    $('#press1').text(data['pressure']);
    $('#gas1').text(data['gas_meter_volume']);
    $('#contr1').text(data['controller_volume']);
    $('#station-selected').text(data['station']);
    $('#device-selected').text(data['device']);
    $('#coefficient').text(Number(data['coefficient']).toFixed(4));
    $('#expectedVolume').text(Number(data['theoretical_controller_volume']).toFixed(1));
    $('#error').text(Number(data['error']).toFixed(1));
    

}


</script>

{% endblock content %}

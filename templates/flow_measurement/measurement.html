{% extends "base_left_menu.html" %}
{% block head %}
<style>
h2 {
    margin-bottom: 20px;
}
.hidden {
    visibility: hidden;
}
.visible {
    visibility: visible;
}
.test {
    border-style: solid;
    border-color: red;
</style>
{% endblock head %}

{% block content %}
	<div class="col-sm-7 text-center">
	    <h3 class="text-left mb-3"> Measurement </h3>
	    <form method='POST' id='values-form'> {% csrf_token %}
            <div class="form-group row">
                <select class="form-control col-sm-10" id='station' form='values-form'>
                    <option value='0'> station </option>
                {% for station in stations %}
                    <option value='{{ station.id }}'> {{ station.name }} </option>
                {% endfor %}
                </select> <a role="button" class="btn col-sm-2" href="{% url 'add-station' %}">add</a>
            </div>
            <div class="form-group row">
            <select class="form-control col-sm-10" id='reference-device' form='values-form'>
                <option value='0'> reference device </option>
            {% for device in reference_devices %}
            <option value='{{ device.id }}'> {{ device.name }}, {{ device.serial_number }}
            </option>
            {% endfor %}
            </select><a role="button" class="btn col-sm-2" href="{% url 'add-device' %}">add</a>
            </div>
            <div class="form-group row">
            <select class="form-control col-sm-10" id='measured-device' form='values-form'>
                <option value='0'> measured device </option>
            {% for device in measured_devices %}
            <option value='{{ device.id }}'> {{ device.name }}, {{ device.serial_number }}
            </option>
            {% endfor %}
            </select> <a role="button" class="btn col-sm-2" href="{% url 'add-device' %}">add</a>
            </div>

				<div class="form-group row justify-content-start">
					<div class="col-sm-10 m-0 p-0 mt-3 mb-3">
                        <input class="form-control col-sm-12"
                               name='temperature' type='number' step='0.1' id='temperature' placeholder='temperature [&#176;C]' />
                        <input class="form-control col-sm-12" name='pressure' type='number' step='0.01' id='pressure' placeholder='atm. pressure [hPa]' />
					</div>
					<div class="col-sm-2 m-0 p-0 align-self-center">
                        <a role="button" id="btn-temp-press" class="btn" href="">download</a>
					</div>
				</div>
				<div class="form-group row justify-content-start">
                        <input class="form-control col-sm-10" type='date' id='measurement-date' placeholder='date of measurement' />
					<div class="col-sm-2 m-0 p-0 align-self-center">
                        <a role="button" id="btn-today" class="btn" href="">today</a>
                    </div>
				</div>

				<div class="form-group row justify-content-start">
					<input class="form-control col-sm-10" type='time'
                    id='measurement-time' placeholder='measurement time [m:s]' />
				</div>

				<div class="form-group row justify-content-start">
					<input class="form-control col-sm-10" type='number'
                    id='reference-device-volume' placeholder='reference device volume [m&#179;]' />
				</div>

				<div class="form-group row justify-content-start">
					<input class="form-control col-sm-10" type='number'
                    id='measured-device-volume' placeholder='measured device volume [m&#179;]' /><br />
				</div>
				<input class="mt-8" type='submit' id='submit-button' value='calculate' />
	    </form>
	</div>
	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
		<h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		  <span aria-hidden="true">&times;</span>
		</button>
	      </div>
	      <div class="modal-body">
		...
	      </div>
	      <div class="modal-footer">
		<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Close</button>
		<button type="button" class="btn btn-primary btn-sm">Save changes</button>
	      </div>
	    </div>
	  </div>
	</div>



<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'> </script>

<script>

$('#btn-temp-press').on('click', function(e) {
    e.preventDefault();
    getTempPress();
});

function getTempPress() {
    $.ajax({
        type: 'POST',
        url: '/get_temp_press/',
        data: {
            station: $('#station option:selected').val(),
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) {
            insertValues(data);
        },
    })
}

function insertValues(data) {
    $('#temperature').val(data['temperature']);
    $('#pressure').val(data['pressure']);
}

$('#btn-today').on('click', function(e) {
    e.preventDefault();
    $.ajax({
        type: 'POST',
        url: '/get_todays_date/',
        data: {
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
        },
        success: function(data) {
            $('#measurement-date').val(data['date']);
        },
    })
});

$('#values-form').on('submit', function(e) {
    e.preventDefault();
    addParameters();
});

function addParameters() {
    console.log($('#measurement_date').val())
    $.ajax({
        type: 'POST',
        url: '/parameters/',
        data: {
            station: $('#station option:selected').val(),
            reference_device: $('#reference-device option:selected').val(),
            measured_device: $('#measured-device option:selected').val(),
            temperature: $('#temperature').val(),
            pressure: $('#pressure').val(),
            measurement_date: $('#measurement-date').val(),
            measurement_time: $('#measurement-time').val(),
            refDevVolume: $('#reference-device-volume').val(),
            measDevVolume: $('#measured-device-volume').val(),
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) {
            console.log('It works!');
            displayValues(data);
        }

    })
}

function displayValues(data) {
    console.log(data);
    $('#exampleModal .modal-body').html(data);
    $('#exampleModal').modal('show');
    

}

function displayValuesModal() {
}

</script>

{% endblock content %}
